# 微信公众号文章迁移工具使用说明

## 概述

本工具用于从微信公众号精选文章页面迁移文章到 Hexo 博客。

## 快速开始

### 方法一：自动迁移（推荐，但可能因反爬虫失败）

```bash
cd blog/migration
pip install -r requirements.txt
python scripts/run_migration.py
```

### 方法二：手动辅助迁移

如果自动抓取失败，可以手动提供文章链接：

1. **手动抓取文章**：
```bash
python scripts/manual_fetch.py
```
按提示输入文章链接和标题，工具会自动抓取内容。

2. **继续后续步骤**：
```bash
python scripts/convert_format.py
python scripts/check_duplicates.py
python scripts/import_posts.py
```

### 方法三：完全手动

1. **创建文章列表文件**：
   复制 `data/articles_list_template.json` 为 `data/articles_list.json`
   填写文章信息（标题、链接、时间戳）

2. **执行转换和导入**：
```bash
python scripts/convert_format.py
python scripts/check_duplicates.py
python scripts/import_posts.py
```

## 脚本说明

### 1. fetch_articles.py
- 自动从微信公众号专辑页面抓取文章列表
- 抓取每篇文章的详细内容
- 保存为HTML格式

### 2. convert_format.py
- 将HTML内容转换为Markdown格式
- 生成Hexo front-matter
- **自动清理引流链接**（移除"感谢关注公众号"等内容）

### 3. check_duplicates.py
- 检查哪些文章已存在于博客中
- 避免重复导入

### 4. import_posts.py
- 将转换后的文章导入到 `blog/source/_posts/` 目录
- 自动生成合适的文件名

## 注意事项

1. **反爬虫机制**：微信公众号有反爬虫机制，自动抓取可能失败
2. **手动输入**：如果自动抓取失败，可以使用 `manual_fetch.py` 手动输入链接
3. **引流链接清理**：工具会自动清理文章末尾的微信公众号引流内容
4. **去重检查**：工具会自动检查重复，避免导入已存在的文章

## 文件结构

```
migration/
├── scripts/
│   ├── fetch_articles.py      # 自动抓取脚本
│   ├── manual_fetch.py        # 手动辅助抓取
│   ├── convert_format.py      # 格式转换
│   ├── check_duplicates.py   # 去重检查
│   ├── import_posts.py        # 导入文章
│   └── run_migration.py        # 主执行脚本
├── data/
│   ├── articles_list.json     # 文章列表（自动生成或手动创建）
│   ├── articles_list_template.json  # 模板文件
│   ├── articles_raw/          # 原始HTML文件
│   └── articles_markdown/     # 转换后的Markdown
└── requirements.txt            # Python依赖
```

## 常见问题

**Q: 自动抓取失败怎么办？**
A: 使用 `manual_fetch.py` 手动输入文章链接，或手动创建 `articles_list.json` 文件。

**Q: 如何获取文章的时间戳？**
A: 可以从微信公众号文章页面的源代码中查找，或使用文章发布日期的Unix时间戳。

**Q: 引流链接没有被清理？**
A: 检查 `convert_format.py` 中的清理规则，可能需要根据实际情况调整。

## 后续步骤

迁移完成后：
1. 检查导入的文章格式
2. 运行 `hexo server` 本地预览
3. 确认无误后运行 `hexo deploy` 部署
